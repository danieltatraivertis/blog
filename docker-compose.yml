version: '3'

volumes:
  data:
    driver: local

services:
  django:
    environment:
      - PYTHONUNBUFFERED=true
    image: blog-django
    build:
      context: .
      dockerfile: Docker/django/Dockerfile
    volumes:
      - ./Djangoproject:/code
      - "data:/data"
    stop_signal: SIGINT
    env_file: .env

  nginx:
    image: blog-nginx
    build:
      context: .
      dockerfile: Docker/nginx/Dockerfile
    volumes:
      - ./Djangoproject:/code
      - ./Docker/nginx/nginx.conf:/tmp/nginx.conf
      - ./Docker/nginx/nginx_uwsgi.conf:/tmp/nginx_uwsgi.conf
      - ./Docker/nginx/nginx_mime.types:/nginx_mime.types
      - ./Docker/nginx/nginx_uwsgi_params:/nginx_uwsgi_params
      - ./Docker/nginx/entrypoint.sh:/entrypoint.sh
      - "data:/data"
    ports:
      - "80:80"
    command: ['nginx']
    entrypoint: ['/entrypoint.sh']
    env_file: .env

  postgres:
    image: blog-postgres
    build:
      context: .
      dockerfile: Docker/postgres/Dockerfile
